{{template "base" .}}

{{define "title"}}
    <title>Major's Page</title>
{{end}}

{{define "content"}}
    <!-- container -->
    <div class="container" style="margin-top: 60px;">
        <div class="row">
            <div class="col">
                <img src="static/images/marjors-suite.png" alt="generals quaters" class="img-fluid img-thumbnail room-image mx-auto d-block">
            </div>
        </div>
        <div class="row">
            <div class="col">
              <h1 class="text-center">Majors Suite</h1>
              <p>Your home away from home, set on the majestic water of the Atlantic ocean. This will be a vaccation to remember.Your home away from home, set on the majestic water of the Atlantic ocean. This will be a vaccation to remember.Your home away from home, set on the majestic water of the Atlantic ocean. This will be a vaccation to remember.Your home away from home, set on the majestic water of the Atlantic ocean. This will be a vaccation to remember.Your home away from home, set on the majestic water of the Atlantic ocean. This will be a vaccation to remember.Your home away from home, set on the majestic water of the Atlantic ocean. This will be a vaccation to remember.
              </p>
            </div>
        </div>
        <div class="row">
          <div class="col text-center">
            <a href="#!" class="btn btn-success" id="check-availability-button">Check Availability</a>
          </div>
        </div>
    </div>
{{end}}

{{define "js"}}
    <script type="text/javascript">
        document.getElementById("check-availability-button").addEventListener('click', () => {
                let html = `
                    <form id="check-availability-form" action="" method="post" class="needs-validation" novalidate>
                    <div class="row" id="date_picker">
                        <div class="col">
                            <input required class="form-control" type="text" name="start" id="start" placeholder="arrival" required disabled>
                        </div>
                        <div class="col">
                            <input required class="form-control" type="text" name="end" id="end" placeholder="departure"  required disabled>
                        </div>
                    </div>
                    </form>
                `;
                    alertPrompt.custom({
                    msg:html, 
                    title:"choose your dates.",
                    willOpen: () => {
                        let calElement = document.getElementById("date_picker")
                        const rangepicker = new DateRangePicker(calElement, {
                            buttonClass: 'btn',
                            format: "yyyy-mm-dd",
                            minDate: "Date",
                            autohide: true
                        });
                        },
                    didOpen: () => {
                        document.getElementById("start").removeAttribute('disabled'),
                        document.getElementById("end").removeAttribute('disabled')
                    },
                    callback: function(result) {
                    let form = document.getElementById("check-availability-form");
                    let formData = new FormData(form);
                    formData.append("csrf_token", {{.CSRFToken}})
                    formData.append("room_id", "5")
                        fetch("/search-availability-json", {
                            method: "post",
                            body:formData,
                        })
                            .then(response => response.json())
                            .then(data => {
                                if(data.ok) {
                                    alertPrompt.custom({
                                        icon: "success",
                                        showConfirmButton: false,
                                        msg: '<p>Room is available!</p>'
                                              + '<p><a href="/book-room?id='
                                              + data.room_id
                                              + '&s='
                                              + data.start_date
                                              +'&e='
                                              + data.end_date
                                              +'" class="btn btn-primary">' 
                                              + 'Book Now!</a></p>'
                                        
                                    })
                                } else {
                                    alertPrompt.error({msg: "No availability!"})
                                }
                            })
                    }
                    })
                    });
        </script>
{{end}}

